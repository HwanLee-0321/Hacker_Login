# GDBμ‹¤μµ 

## [μ‹¤μµ Cμ½”λ“ - chall.c]
```c
#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/types.h>
#include <sys/stat.h>

void create_password(char *password, int len) {
    int fd = open("/dev/urandom", O_RDONLY);

    for (int i = 0; i < len; ) {
        char c;

        read(fd, &c, 1);
        if (0x20 < c && c < 0x7e)
            password[i++] = c;
    }
    close(fd);
}

int main() { 
    char buf[16] = { 0 }, password[16] = { 0 };
    int len = sizeof(password) - 1;

    // ignore this
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);

    // create password with random bytes
    create_password(password, len);

    printf("Enter password : ");
    read(0, buf, sizeof(buf) - 1);

    if (!strcmp(buf, password))
        printf("Correct!\n");
    else
        printf("Wrong!\n");

    return 0;
}
```

## λ©ν‘
- λ©ν‘λ¥Ό μ•λ ¤λ©΄ μ΄ μ½”λ“λ¥Ό ν•΄μ„ ν•΄μ•Όν•λ‹¤.
- κ°„λ‹¨ν ν•΄μ„ν•΄λ³΄μλ©΄
```
μ΄ μ½”λ“μ λ™μ‘μ„ κ°„λ‹¨ν μ„¤λ…ν•λ©΄ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.
main() ν•¨μλ” create_password() ν•¨μλ¥Ό νΈμ¶ν•μ—¬ password[] λ°°μ—΄μ„ λλ¤ν• κ°’μΌλ΅ μ΄κΈ°ν™”ν•©λ‹λ‹¤.
read() ν•¨μλ¥Ό νΈμ¶ν•μ—¬ μ‚¬μ©μμ μ…λ ¥μ„ λ°›μ•„ buf[] λ°°μ—΄μ— μ €μ¥ν•©λ‹λ‹¤.
strcmp() ν•¨μλ¥Ό νΈμ¶ν•μ—¬ buf[] μ™€ password[] λ°°μ—΄μ λ‚΄μ©μ„ λΉ„κµν•κ³  κ°™μΌλ©΄ β€Correct!β€, λ‹¤λ¥΄λ©΄ β€Wrong!β€μ„ μ¶λ ¥ν•©λ‹λ‹¤.
```

>> λ”°λΌμ„ Correct! κ°€ μ¶λ ¥λλ”κ² λ©ν‘μ΄λ‹¤.

## [λ¬Έμ ν’€μ΄1] - μ§μ ‘ ν¨μ¤μ›λ“ μ…λ ¥


- λΉ„λ°€λ²νΈκ°€ μ–΄λ””μ„ μƒμ„±λλ”μ§€ ν™•μΈν•΄λ³΄μ.
```c
    create_password(password, len);
```

μ΄ λ¶€λ¶„μ λ©”λ¨λ¦¬ κ°’ ν™•μΈν•λ” λ²•μ€ λ‹¤μκ³Ό κ°™λ‹¤

### 1. disassλ΅ mainν•¨μμ λ©”λ¨λ¦¬ λ™μ‘ ν™•μΈ
**[λ…λ Ήμ–΄]**
```shell
disass main
```

**[κ²°κ³Ό]**
![alt text](image.png)

[!] μ£Όλ©ν•΄μ•Όν•  μ μ€ μ΄ λ¶€λ¶„μ΄λ‹¤.

```gdb
   0x0000555555555362 <+138>:   call   0x555555555229 <create_password>
```

mainν•¨μ μ‹μ‘ λ μ§€μ¤ν„° κ°’μ—μ„ 138μ„ λ”ν• λ©”λ¨λ¦¬μ—μ„ μ •ν™•ν <create_password>λ¥Ό ```call```ν•΄μ£Όκ³  μλ‹¤.

### 2. λΈλ μ΄ν¬ ν¬μΈνΈ κ±ΈκΈ°
μ•μ—μ„ ν™•μΈν•  μ μλ“―μ΄ λ©”μΈν•¨μ μ‹¤ν–‰ λ©”λ¨λ¦¬μ—μ„ 138μ„ λ”ν• κ°’μ—μ„ breakν¬μΈνΈλ¥Ό κ±Έμ–΄μ£Όλ©΄ ν¨μ¤μ›λ“κ°€ μƒμ„±λλ” μ§€μ μ—μ„ ν”„λ΅κ·Έλ¨ λ™μ‘μ„ μ΅°μ •ν•  μ μλ‹¤.

ν•΄λ‹Ή λΈλ μ΄ν¬ ν¬μΈνΈ λ…λ Ήμ–΄λ” λ‹¤μκ³Ό κ°™λ‹¤
```gdb
break *(main+138)
```

### 3. λΉ„λ°€λ²νΈ ν™•μΈ
μ΄μ  ν¨μ¤μ›λ“κ°€ μƒμ„±μ΄ λμ—λ‹¤.

μ΄μ  μ¤‘μ”ν• κ²ƒμ€ **ν¨μ¤μ›λ“ ν™•μΈ**μ΄λ‹¤.

ν•΄λ‹Ή ```create_password```κ°€ μ‹¤ν–‰λλ” λ μ§€μ¤ν„° κ°’μ— λ¶„λ… ν¨μ¤μ›λ“κ°€ μ €μ¥λμ–΄μμ„ κ²ƒμ΄λ‹¤.

gdbλ¥Ό κΉλ³΄μ

![alt text](image-1.png)

```DISASM(λ””μ¤μ–΄μ…λΈ”λ¦¬μμ—­)```μ—μ„ create_passwordκ°€ callν•΄μ§„ λ μ§€μ¤ν„°κ°’μ„ ν™•μΈ

ν•΄λ‹Ή λ μ¤ν„°μ— μλ” κ°’μ„ λ©”λ¨λ¦¬ μ΅°μ‘μ„ ν•΄λ³΄μ!

### 4. λ©”λ¨λ¦¬ μ΅°μ‘

λ©”λ¨λ¦¬ μ΅°μ‘ λ°©λ²•μ€ λ‹¤μκ³Ό κ°™λ‹¤

```shell
λ©”λ¨λ¦¬ μ΅°μ‘
- x/[n][size][format] [address] - address μ£Όμ†λ¶€ν„° κ°’ n κ°λ¥Ό νΉμ • ν•μ‹μΌλ΅ μ¶λ ¥ν•©λ‹λ‹¤.
 - n - 1 μ΄λ©΄ μƒλµ κ°€λ¥
 - size - b (λ°”μ΄νΈ), h (2λ°”μ΄νΈ), w (4λ°”μ΄νΈ), g (8λ°”μ΄νΈ)
 - format - d (10μ§„μ), x/ (16μ§„μ),s (μ•„μ¤ν‚¤ λ¬Έμμ—΄), i (μΈμ¤νΈλ­μ…)
- telescope [address] - address μ£Όμ†λ¶€ν„° λ©”λ¨λ¦¬μ κ°’λ“¤μ„ μ λ‹Ήν• ν•μ‹μΌλ΅ μ¶λ ¥ν•©λ‹λ‹¤.
- set *[address]=[value] - address μ£Όμ†μ— κ°’ value λ¥Ό λ€μ…ν•©λ‹λ‹¤.

create_password() ν•¨μκ°€ λ¨λ‘ μ‹¤ν–‰λ μƒνƒμ—μ„ μ•μ„ λ³µμ‚¬ν• password[] λ°°μ—΄ μ£Όμ†μ κ°’μ„ ν™•μΈν•λ©΄ ν¨μ¤μ›λ“λ¥Ό μ•μ•„λ‚Ό μ μμµλ‹λ‹¤. x μ»¤λ§¨λ“λ¥Ό μ΄μ©ν•μ—¬ λ©”λ¨λ¦¬μ λ‚΄μ©μ„ μ΅°μ‚¬ν•  μ μμµλ‹λ‹¤. μλ¥Ό λ“¤μ–΄ password[] λ°°μ—΄ μ£Όμ†μ λ¬Έμμ—΄ ν•λ‚λ¥Ό μ¶λ ¥ν•κΈ° μ„ν•΄μ„λ” x/s μ»¤λ§¨λ“λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.
```

λ”°λΌμ„ ν•΄λ‹Ή λ μ¤ν„° κ°’μ„ κ³ λ ¤ν•
``` x/s 0x7fffffffda80 ``` μ„ μ…λ ¥ν•΄μ£Όλ©΄ μ‚¬μ§„κ³Ό κ°™λ‹¤.

![alt text](image-2.png)

### 5. μ •λ‹µμ¶λ ¥

ν¨μ¤μ›λ“μ stringκ°’μ΄ ```JMmBkYG@|]kYsb3``` μ„μ„ ν™•μΈν•  μ μκ³ 

```continue```λ΅ κ³„μ†ν•΄μ£Όλ©΄

![alt text](image-3.png)

μ‚¬μ§„κ³Ό κ°™μ΄ Correct!κ°€ μ¶λ ¥λ¨μ„ μ• μ μλ‹¤.


## [λ¬Έμ ν’€μ΄2] - λ μ§€μ¤ν„° κ°’ μ΅°μ‘ν•΄μ„ κ°•μ  Correct!μ¶λ ¥

### [λ¬Έμ ν’€μ΄1] μ¥λ‹¨μ 

#### μ¥μ 
- μ‰½λ‹¤!
- μ§κ΄€μ μ΄λ‹¤!


#### λ‹¨μ 
- ν•λ‚ν•λ‚ λ μ§€μ¤ν„° κ°’ ν™•μΈν•΄μ•Όν•¨
- μ‹¤ν–‰ ν•  λ•λ§λ‹¤ password[] λ°°μ—΄ κ°’μ΄ λ‹¬λΌμ§

> μΌλ‹¨ λ‚λ” μ‰½κ³  μ§κ΄€μ μΈ ν’€μ΄? μΆ‹μ•„ν•λ‹¤
κ·Έλ¦¬κ³  λ©ν‘ μμ²΄κ°€ ```Correct!```λ¥Ό μ¶λ ¥ν•λ”κ²ƒμ΄λΌλ©΄ κµ³μ΄ password[] λ°°μ—΄μ„ ν™•μΈν•  ν•„μ”κ°€ μ—†λ‹¤.

### [!]κ·Έλƒ¥ strcmpμ—μ„ ν†µκ³Όλ§ λλ©΄ λ

μΌλ‹¨ strcmp ν•¨μ νΈμ¶ λ¶€λ¶„μ„ μ²΄ν¬

![alt text](image.png)

μ„ μ‚¬μ§„μ—μ„ λ³΄λ©΄ ```0x00000000000013a4 <+204>:   test   eax,eax``` μ΄ λ¶€λ¶„μ΄ buf μ™€ password κ°’μ„ λΉ„κµν•λ” λ¶€λ¶„μ΄λ‹¤.

### raxκ°’ μ„¤μ •

strcmp ν•¨μμ λ¦¬ν„΄ κ°’μ„ ν™•μΈν•  ν•„μ”κ°€ μλ”λ°, ν•΄λ‹Ή λ¦¬ν„΄κ°’μ μ €μ¥ μμ„λ” λ‹¤μκ³Ό κ°™λ‹¤.

```
π“ κ³µμ‹ κ·μ•½ λ¬Έμ„ λ‚΄μ© (μ”μ•½)
μΈμ(argument)λ“¤μ€ rdi, rsi, rdx, rcx, r8, r9 μ— μ°¨λ΅€λ΅ λ“¤μ–΄κ°

ν•¨μμ λ¦¬ν„΄κ°’μ€ λ¬΄μ΅°κ±΄ raxμ— μ €μ¥
```

λ”°λΌμ„ strcmp μ λ¦¬ν„΄ κ°’μΈ raxλ¥Ό '0'μΌλ΅ setν•΄μ£Όλ©΄ λλ‹¤.

![alt text](image-4.png)

**[κ²°κ³Ό]**: μ •μƒμ μΌλ΅ ```Correct!```κ°€ μ¶λ ¥λλ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.